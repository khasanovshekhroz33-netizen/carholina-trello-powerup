<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Carholina OneClick</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f9fafc; }
    h1 { color: #0a4d8c; }
    button {
      background: #0a4d8c; color: white; border: none;
      padding: 12px 20px; border-radius: 6px; font-size: 16px;
      cursor: pointer; margin: 5px;
    }
    button:hover { background: #06345d; }
    #log {
      margin-top: 20px; padding: 10px; background: #fff; border: 1px solid #ccc;
      border-radius: 6px; height: 200px; overflow-y: auto;
      font-family: monospace; font-size: 13px; white-space: pre-line;
    }
  </style>
</head>
<body>
  <h1>Carholina OneClick Setup</h1>
  <p>–ù–∞–∂–º–∏—Ç–µ ¬´–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è¬ª, –∑–∞—Ç–µ–º ¬´–°–æ–∑–¥–∞—Ç—å –¥–æ—Å–∫—É¬ª. –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
  <button id="authBtn">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</button>
  <button id="createBtn" disabled>–°–æ–∑–¥–∞—Ç—å –¥–æ—Å–∫—É Carholina</button>
  <button id="logoutBtn">–í—ã–π—Ç–∏ (—Å–±—Ä–æ—Å–∏—Ç—å —Ç–æ–∫–µ–Ω)</button>
  <p id="status">–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏‚Ä¶</p>
  <div id="log">‚ÑπÔ∏è –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å‚Ä¶</div>

<script>
  const API_KEY   = "f0459a9c4c84226e29b03e7d047b9dfb";
  const BOARD_NAME= "Carholina MVP";
  const LISTS     = ["To Do", "In Progress", "Done", "Features"];

  const logEl=document.getElementById("log"),statusEl=document.getElementById("status"),
        authBtn=document.getElementById("authBtn"),createBtn=document.getElementById("createBtn"),
        logoutBtn=document.getElementById("logoutBtn");
  const log=(m)=>{logEl.textContent+=m+"\n";logEl.scrollTop=logEl.scrollHeight;};
  const setStatus=(m)=>{statusEl.textContent="–°—Ç–∞—Ç—É—Å: "+m;};

  const TOKEN_KEY="trello_token_carholina";
  const getToken=()=>localStorage.getItem(TOKEN_KEY);
  const setToken=(t)=>localStorage.setItem(TOKEN_KEY,t);
  const clearToken=()=>localStorage.removeItem(TOKEN_KEY);

  function extractTokenFromHash(){if(!location.hash)return null;const m=location.hash.match(/token=([^&]+)/);return m?decodeURIComponent(m[1]):null;}
  function scrubHash(){if(history.replaceState)history.replaceState(null,document.title,location.pathname+location.search);else location.hash="";}
  function buildAuthorizeUrl(){const returnUrl=location.origin+location.pathname;const params=new URLSearchParams({expiration:"never",name:"CarholinaApp",scope:"read,write",response_type:"token",key:API_KEY,return_url:returnUrl});return `https://trello.com/1/authorize?${params.toString()}`;}
  function authorize(){location.href=buildAuthorizeUrl();}
  function logout(){clearToken();createBtn.disabled=true;setStatus("—Ç–æ–∫–µ–Ω —É–¥–∞–ª—ë–Ω; –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ");log("‚ÑπÔ∏è –¢–æ–∫–µ–Ω —É–¥–∞–ª—ë–Ω.");}

  async function req(url,opt){const r=await fetch(url,opt);let d=null;try{d=await r.json();}catch{}if(!r.ok){throw new Error((d&&(d.message||d.error))||r.status+" "+r.statusText);}return d;}

  async function createBoard(){
    const token=getToken(); if(!token){setStatus("–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞ ‚Äî –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å");log("‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞.");return;}
    try{
      setStatus("—Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏‚Ä¶");log("‚è≥ –°–æ–∑–¥–∞—ë–º –¥–æ—Å–∫—É‚Ä¶");
      const board=await req(`https://api.trello.com/1/boards/?name=${encodeURIComponent(BOARD_NAME)}&defaultLists=false&key=${API_KEY}&token=${token}`,{method:"POST"});
      log("‚úÖ –î–æ—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: "+board.url);

      // —Å–ø–∏—Å–∫–∏
      for(const l of LISTS){await req(`https://api.trello.com/1/lists?name=${encodeURIComponent(l)}&idBoard=${board.id}&key=${API_KEY}&token=${token}`,{method:"POST"});log("‚ûï –°–ø–∏—Å–æ–∫: "+l);}
      // –º–µ—Ç–∫–∏
      const labels=[{name:"–í –ø—É—Ç–∏",color:"yellow"},{name:"–ó–∞–≤–µ—Ä—à–µ–Ω–æ",color:"green"},{name:"–°—Ä–æ—á–Ω–æ",color:"red"}];
      for(const lbl of labels){await req(`https://api.trello.com/1/labels?name=${encodeURIComponent(lbl.name)}&color=${lbl.color}&idBoard=${board.id}&key=${API_KEY}&token=${token}`,{method:"POST"});log("üè∑ –ú–µ—Ç–∫–∞: "+lbl.name);}
      // –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —á–µ–∫–ª–∏—Å—Ç–∞–º–∏
      const listsData=await req(`https://api.trello.com/1/boards/${board.id}/lists?key=${API_KEY}&token=${token}`);
      const cards=[
        {name:"üöó –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞",list:"To Do",check:["–ü–æ–ª—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã","–ù–∞–∑–Ω–∞—á–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è","–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç"]},
        {name:"üì¶ –í –ø—É—Ç–∏",list:"In Progress",label:"–í –ø—É—Ç–∏",check:["–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–µ–∫–µ—Ä","–°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º"]},
        {name:"‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ",list:"Done",label:"–ó–∞–≤–µ—Ä—à–µ–Ω–æ",check:["–ó–∞–∫—Ä—ã—Ç—å –∑–∞–∫–∞–∑","–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç"]},
      ];
      for(const c of cards){
        const list=listsData.find(l=>l.name===c.list); if(!list)continue;
        let cardUrl=`https://api.trello.com/1/cards?name=${encodeURIComponent(c.name)}&idList=${list.id}&key=${API_KEY}&token=${token}`;
        let newCard=await req(cardUrl,{method:"POST"});
        log("üìù –ö–∞—Ä—Ç–æ—á–∫–∞: "+c.name);
        if(c.check&&c.check.length){
          const checklist=await req(`https://api.trello.com/1/cards/${newCard.id}/checklists?name=–ß–µ–∫–ª–∏—Å—Ç&key=${API_KEY}&token=${token}`,{method:"POST"});
          for(const item of c.check){
            await req(`https://api.trello.com/1/checklists/${checklist.id}/checkItems?name=${encodeURIComponent(item)}&key=${API_KEY}&token=${token}`,{method:"POST"});
            log("   ‚òëÔ∏è "+item);
          }
        }
      }
      setStatus("–≥–æ—Ç–æ–≤–æ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞—é –¥–æ—Å–∫—É");log("üöÄ –û—Ç–∫—Ä—ã–≤–∞—é –¥–æ—Å–∫—É‚Ä¶");window.open(board.url,"_blank");
    }catch(e){setStatus("–æ—à–∏–±–∫–∞");log("‚ùå "+e.message);alert("–û—à–∏–±–∫–∞: "+e.message);}
  }

  (function init(){
    const t=extractTokenFromHash(); if(t){setToken(t);scrubHash();log("üîê –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω.");}
    if(getToken()){createBtn.disabled=false;setStatus("–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –µ—Å—Ç—å");}else{createBtn.disabled=true;setStatus("–æ–∂–∏–¥–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏‚Ä¶");}
    authBtn.addEventListener("click",authorize);createBtn.addEventListener("click",createBoard);logoutBtn.addEventListener("click",logout);
  })();
</script>
</body>
</html>
